{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üí° –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—ã</h1>
    <p>–ü—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –∏–¥–µ–∏, –≥–æ–ª–æ—Å—É–π—Ç–µ –∑–∞ –ª—É—á—à–∏–µ, —É–ª—É—á—à–∞–π—Ç–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –≤–º–µ—Å—Ç–µ!</p>
</div>

{% if initiatives %}
    <div class="initiatives-count">
        <p><i class="fas fa-list"></i> –ù–∞–π–¥–µ–Ω–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤: {{ pagination.total }}</p>
        {% if pagination.pages > 1 %}
        <p><i class="fas fa-file-alt"></i> –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ pagination.page }} –∏–∑ {{ pagination.pages }}</p>
        {% endif %}
    </div>

    {% for initiative in initiatives %}
    <div class="initiative-card">
        <div class="initiative-header">
            <h3>{{ initiative.title }}</h3>
            <div class="score {{ 'positive' if initiative.score >= 0 else 'negative' }}">
                {{ initiative.score }}
            </div>
        </div>
        
        <div class="initiative-meta">
            <span><i class="fas fa-user"></i> {{ initiative.author.username }}</span>
            <span><i class="fas fa-calendar"></i> {{ initiative.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
        </div>
        
        <div class="initiative-content">
            {{ initiative.content }}
        </div>
        
        <div class="vote-buttons">
            {% if current_user %}
                <a href="{{ url_for('vote', initiative_id=initiative.id, value=1, page=pagination.page) }}" 
                   class="btn-vote upvote {% if initiative.user_vote == 1 %}active{% endif %}">
                    <i class="fas fa-thumbs-up"></i> 
                    –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å 
                    {% if initiative.user_vote == 1 %}<span style="margin-left: 5px;">‚úì</span>{% endif %}
                </a>
                <a href="{{ url_for('vote', initiative_id=initiative.id, value=-1, page=pagination.page) }}" 
                   class="btn-vote downvote {% if initiative.user_vote == -1 %}active{% endif %}">
                    <i class="fas fa-thumbs-down"></i> 
                    –ü—Ä–æ—Ç–∏–≤
                    {% if initiative.user_vote == -1 %}<span style="margin-left: 5px;">‚úì</span>{% endif %}
                </a>
                
                <!-- –ö–ù–û–ü–ö–ò –£–ü–†–ê–í–õ–ï–ù–ò–Ø - –í–´–ù–ï–°–ï–ú –û–¢–î–ï–õ–¨–ù–û -->
            {% else %}
                <p style="color: #666; flex: 1;">
                    <i class="fas fa-info-circle"></i>
                    <a href="{{ url_for('login') }}">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å
                </p>
            {% endif %}
        </div>
        
        <!-- –û–¢–î–ï–õ–¨–ù–´–ô –ë–õ–û–ö –î–õ–Ø –ö–ù–û–ü–û–ö –£–î–ê–õ–ï–ù–ò–Ø –ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
        <div class="action-buttons">
            {% if current_user %}
                {% if current_user.id == initiative.author_id or current_user.is_admin %}
                    <a href="{{ url_for('edit_initiative', initiative_id=initiative.id) }}" 
                       class="btn-edit">
                        <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                    </a>
                    <a href="{{ url_for('delete', initiative_id=initiative.id, page=pagination.page) }}" 
                       class="btn-delete"
                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É ¬´{{ initiative.title }}¬ª?')">
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                    </a>
                {% endif %}
            {% endif %}
        </div>
        
        {% if initiative.score <= -5 %}
        <div class="initiative-warning">
            <i class="fas fa-exclamation-triangle"></i>
            –í–Ω–∏–º–∞–Ω–∏–µ! –ù–∏–∑–∫–∏–π —Ä–µ–π—Ç–∏–Ω–≥. –ü—Ä–∏ -10 –æ—á–∫–∞—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω–∞.
        </div>
        {% endif %}
    </div>
    {% endfor %}

    {% if pagination.pages > 1 %}
    <div class="pagination">
        {% if pagination.has_prev %}
        <a href="{{ url_for('index', page=pagination.prev_num) }}" class="page-link">
            <i class="fas fa-chevron-left"></i> –ù–∞–∑–∞–¥
        </a>
        {% endif %}
        
        <div style="display: flex; gap: 5px;">
            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                {% if page_num %}
                    {% if page_num == pagination.page %}
                    <span class="page-number active">{{ page_num }}</span>
                    {% else %}
                    <a href="{{ url_for('index', page=page_num) }}" class="page-number">{{ page_num }}</a>
                    {% endif %}
                {% else %}
                <span>...</span>
                {% endif %}
            {% endfor %}
        </div>
        
        {% if pagination.has_next %}
        <a href="{{ url_for('index', page=pagination.next_num) }}" class="page-link">
            –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ <i class="fas fa-chevron-right"></i>
        </a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="no-initiatives">
        <i class="fas fa-lightbulb"></i>
        <h2>–ü–æ–∫–∞ –Ω–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤</h2>
        <p>–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∏–¥–µ—é –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞!</p>
        {% if current_user %}
        <a href="{{ url_for('create') }}" class="btn-primary" style="display: inline-block; width: auto; margin-top: 20px;">
            <i class="fas fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É
        </a>
        {% else %}
        <a href="{{ url_for('login') }}" class="btn-primary" style="display: inline-block; width: auto; margin-top: 20px;">
            <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å
        </a>
        {% endif %}
    </div>
{% endif %}

{% if current_user and initiatives %}
<div style="text-align: center; margin-top: 30px;">
    <a href="{{ url_for('create') }}" class="btn-primary" style="display: inline-block; width: auto;">
        <i class="fas fa-plus"></i> –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–≤–æ—é –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É
    </a>
</div>
{% endif %}
{% endblock %}